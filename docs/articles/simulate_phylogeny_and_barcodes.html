<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="qfm">
<title>Simulating cell phylogeny and lineage barcodes from QFM • qfm</title>
<script src="../deps/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating cell phylogeny and lineage barcodes from QFM">
<meta property="og:description" content="qfm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">qfm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basic_tutorial.html">Basic tutorial on Quantitative Fate Mapping (QFM)</a>
    <a class="dropdown-item" href="../articles/operations.html">Operations for count graphs</a>
    <a class="dropdown-item" href="../articles/simulate_phylogeny_and_barcodes.html">Simulating cell phylogeny and lineage barcodes from QFM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulating cell phylogeny and lineage barcodes from QFM</h1>
                        <h4 data-toc-skip class="author">Weixiang
Fang</h4>
            
            <h4 data-toc-skip class="date">2022-11-23</h4>
      
      
      <div class="d-none name"><code>simulate_phylogeny_and_barcodes.Rmd</code></div>
    </div>

    
    
<p>We take one fate map from our previously constructed panel as an
example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">qfm</span><span class="op">)</span></span>
<span><span class="co"># load the panel of fate maps</span></span>
<span><span class="va">tree_panel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../data/example/tree_panel.rds"</span><span class="op">)</span></span>
<span><span class="va">type_graph</span> <span class="op">=</span> <span class="va">tree_panel</span><span class="op">$</span><span class="va">type_graph</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>First, we generate a color scheme and visualize the topology and
commitment times.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_vec</span> <span class="op">=</span> <span class="fu">gr_color_v1</span><span class="op">(</span><span class="va">type_graph</span><span class="op">)</span></span>
<span><span class="fu">plot_type_graph_clean_mod2</span><span class="op">(</span><span class="va">type_graph</span>,</span>
<span>                           node_col_mapper <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">col_vec</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                           show_node_text <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_phylogeny_and_barcodes_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Next, we load lineage barcoding parameters that involve 50
independent barcoding sites. Using this data, we simulate cell phylogeny
and lineage barcodes, sampling 100 cells from each terminal cell types.
In order to sample a different number of cells from each type, a named
numeric vector can be provided to the <code>sample_size</code>
argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mut_p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../data/example/mut_p_marc1.rds"</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simulate_sc_data_mod2</span><span class="op">(</span><span class="va">type_graph</span>, mut_p <span class="op">=</span> <span class="va">mut_p</span>, sample_size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1043</span></span>
<span><span class="co">## [1] 704</span></span>
<span><span class="co">## [1] 473</span></span>
<span><span class="co">## [1] 317</span></span>
<span><span class="co">## [1] 210</span></span>
<span><span class="co">## [1] 131</span></span>
<span><span class="co">## [1] 83</span></span>
<span><span class="co">## [1] 51</span></span>
<span><span class="co">## [1] 31</span></span>
<span><span class="co">## [1] 19</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 1</span></span></code></pre>
<p>The results involve the cell phylogeny <code>sim_data$tr</code>, the
lineage barcodes <code>sim_data$sc</code>, and the sampled population
size for each progenitor states
<code>sim_data$true_sampled_sizes</code>. The barcodes and phylogeny can
be visualized below. The rownames of the lineage barcode character
matrix indicates the cell type of each cell.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_barcodes</span><span class="op">(</span>sc_mat <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">sc</span>,</span>
<span>              tr <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">tr</span>,</span>
<span>              tip_celltype <span class="op">=</span> <span class="fu">get_type_from_id</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">sc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              celltype_col <span class="op">=</span> <span class="va">col_vec</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_phylogeny_and_barcodes_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>For a detailed specifications of fate maps and mutation parameters,
see below.</p>
<div class="section level3">
<h3 id="quantitative-fate-maps-specifications">Quantitative fate maps specifications<a class="anchor" aria-label="anchor" href="#quantitative-fate-maps-specifications"></a>
</h3>
<p>Quantitative fate maps are implemented as the ‘type_graph’ S3
objects, with the following attributes.</p>
<ol style="list-style-type: decimal">
<li>
<strong>‘node_id’</strong>: progenitor states. Progenitor states are
represented by positive integers.</li>
<li>
<strong>‘root-id’</strong>: root state. Root state is one of the
progenitor states represented by the largest positive integer.</li>
<li>
<strong>‘tip_id’</strong>: terminal types. Terminal types are
represented by negative integers.</li>
<li>
<strong>‘merge’</strong>: list of daughter state(s)/type(s) for each
progenitor state.</li>
<li>
<strong>‘diff_time’</strong>: time of progenitor state commitments.
Terminal types have infinite time of commitment.</li>
<li>
<strong>‘diff_mode_probs’</strong>: commitment bias of progenitor
states. Values corresponds to three modes of commitments: symmetric to
downstream state X (first element in ‘merge’), symmetric to downstream
states Y (second element in ‘merge’) and assymetric commitment.</li>
<li>
<strong>‘lifetime’</strong>: the doubling time of cells of each
state/type.</li>
<li>
<strong>‘founder_size’</strong>: the number of cell(s) of the root
state at time zero.</li>
<li>
<strong>‘target_time’</strong>: time of sample collection.</li>
<li>
<strong>‘prob_loss’</strong>: cell death probabilities for each
state/type.</li>
<li>
<strong>‘prob_pm’</strong>: non-doubling proabilities for each
state/type.</li>
<li>
<strong>‘edges’</strong>: edge list. This can be derived from the
information above.</li>
<li>
<strong>‘root_time’</strong>: time until first commitment event of
the root state.</li>
</ol>
</div>
<div class="section level3">
<h3 id="mutagenesis-parameters-specifications">Mutagenesis parameters specifications<a class="anchor" aria-label="anchor" href="#mutagenesis-parameters-specifications"></a>
</h3>
<p>mutatgenesis parameters are implemented as ‘mut_params’ S3 objects,
and have the following attributes.</p>
<p>Suppose the array of barcoding sites have <span class="math inline">\(J\)</span> total elements.</p>
<ol style="list-style-type: decimal">
<li>
<strong>‘mut_rate’</strong>: A vector of length <span class="math inline">\(J\)</span>, that is the mutation rate of the
sites.</li>
<li>
<strong>‘recur_prob’</strong>’: A vector of length <span class="math inline">\(J\)</span>, deprecatad parameter, always set to a
vector of ones.</li>
<li>
<strong>‘active time’</strong>’: A list of range of intervals for
which barcoding is active.</li>
<li>
<strong>‘recur_vec_list’</strong>: A list of allele emergence
probabilities of length <span class="math inline">\(J\)</span>, each
item in the list is a named vector probabilities that sum to <span class="math inline">\(1\)</span>. The names are the mutant allele
names.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Weixiang Fang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
